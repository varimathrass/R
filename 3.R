library("quantmod")  # ?????? ???????????????????? ??????????????????.
library("lubridate") # ?????? ???????????? ?? ????????????.
library("e1071")     # ?????????????????? ?????????????????? ????????????????.
startDate = as.Date("2009-01-01") # ?????????????????? ????????.
endDate = as.Date("2013-12-31")   # ???????????????? ????????.

# ?????????????????? ?????????????????? ?????????????? S&P500 ?? Yahoo Finance:
stock = getSymbols("^GSPC", src = "yahoo", from = startDate, to = endDate, auto.assign=F)
colnames(stock) = c("Open", "High", "Low", "Close", "Volume", "Adjusted") # ?????????? ????????????????.

dayOfWeek = wday(stock, label=T, abbr=T) # ???????? ???????????? ?????? ???????????? ????????.
dr = dailyReturn(Ad(stock), type='arithmetic')  # ?????????????????????????? ???????????????????? ???????? ???? ???????????? ????????.
# ???????????? ???????????? ?????????????? ?? ?????????? ?????????????? ???????????? (?????? ???????? ?????? ?????????????????????? ??????):
dr = dr[-1];  dayOfWeek = dayOfWeek[-1]

# ????????????????????????, ?????????????????????? ?? ?????????????? ???????????????? ???????????????????????????? ???????????????????? ??????:
max(dr); min(dr); mean(dr)

s = 0.0035 # ???????????????????????? ?????????????????????????? ???????????????????? ????????, ?????????????? ???????????????? ???????? ???? ????????????.
# ???????? ?????????????????????????? ???????????????????? ???????? ???????????? s, ???? ?????????? ??????????, ?????????? ????????:
classes = ifelse(dr > s, "1", ifelse(dr < -s, "-1", "0"))

# ?????????? ???????????? ?? ?????????? ???????????????????????? ?? ???????????????? ???????????????? ??????????????:
dataset2 = data.frame(classes[-1], dayOfWeek[-1], classes[-length(classes)])
colnames(dataset2) = c("Class", "DayOfWeek", "YesterdayDirection")
dataset2

train_size = floor(0.75 * nrow(dataset2))
train_data = dataset2[1:train_size, ]
test_data = dataset2[(train_size+1):nrow(dataset2), ]

model = naiveBayes(Class~., data = train_data)

predictions = predict(model, test_data)
table(predictions, test_data$Class)
